<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Replier - Khair</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/sidebar.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="navbar-container">
            <div class="navbar-content">
                <div class="nav-left">
                    <div class="nav-brand">
                        <span class="logo">Khair</span>
                        <span class="tagline">Email Replier Agent</span>
                    </div>
                </div>
                <div class="nav-right">
                    {% if has_gmail %}
                    <div class="nav-search">
                        <div class="search-container">
                            <span class="search-icon">üîç</span>
                            <input type="text" id="emailSearch" class="search-input" placeholder="Search emails..." onkeyup="handleSearch(event)" oninput="handleSearchInput(this.value)">
                            <button class="search-clear" id="searchClear" onclick="clearSearch()" style="display: none;">√ó</button>
                        </div>
                    </div>
                    {% endif %}
                    <div class="nav-actions">
                        {% if has_gmail %}
                        <button class="refresh-btn" id="refreshEmailsBtn" onclick="refreshEmails()" title="Refresh emails">
                            <span class="icon">üîÑ</span>
                        </button>
                        <div class="gmail-dropdown">
                            <button class="btn btn-gmail" onclick="toggleGmailDropdown(event)" id="gmailDropdownBtn">
                                üìß Connected
                            </button>
                            <div class="gmail-dropdown-menu" id="gmailDropdownMenu" style="display: none;">
                                <div class="gmail-dropdown-header">
                                    <strong>Connected Account</strong>
                                </div>
                                <div class="gmail-dropdown-email">
                                    {{ gmail_email or 'Gmail Connected' }}
                                </div>
                                <a href="{{ url_for('disconnect_gmail') }}" class="gmail-dropdown-disconnect">
                                    Disconnect
                                </a>
                            </div>
                        </div>
                        {% else %}
                        <a href="{{ url_for('connect_gmail') }}" class="btn btn-gmail" title="Connect Gmail account">
                            üìß Login
                        </a>
                        {% endif %}
                        <button class="btn btn-secondary" onclick="openSettingsModal()" title="Settings" style="font-size: 12px; padding: 6px 12px; margin-right: 8px;">
                            ‚öôÔ∏è Settings
                        </button>
                        <span class="user-info">{{ current_user.username }}</span>
                        <a href="{{ url_for('logout') }}" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;">Logout</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="dashboard-layout">
        {% if has_gmail %}
        <!-- Hamburger Menu Button (positioned above sidebar) -->
        <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
            <span class="hamburger-icon">‚ò∞</span>
        </button>
        
        <!-- Left Sidebar (Gmail-style) -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-nav">
                <button class="sidebar-item active" onclick="switchTab('all')" data-tab="all" data-label="Inbox">
                    <span class="sidebar-icon icon-inbox">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                        </svg>
                    </span>
                    <span class="sidebar-label">Inbox</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('sent')" data-tab="sent" data-label="Sent">
                    <span class="sidebar-icon icon-sent">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </span>
                    <span class="sidebar-label">Sent</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('starred')" data-tab="starred" data-label="Starred">
                    <span class="sidebar-icon icon-starred">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                    </span>
                    <span class="sidebar-label">Starred</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('drafts')" data-tab="drafts" data-label="Drafts">
                    <span class="sidebar-icon icon-drafts">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </span>
                    <span class="sidebar-label">Drafts</span>
                </button>
            </nav>
            
            <div class="sidebar-divider"></div>
            
            <div class="sidebar-section collapsed" id="categoriesSection">
                <div class="sidebar-section-title" onclick="toggleCategoriesSection()">CATEGORIES</div>
                <button class="sidebar-item" onclick="switchTab('deal-flow')" data-tab="deal-flow" data-label="Deal Flow">
                    <span class="sidebar-icon icon-deal-flow">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                            <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
                        </svg>
                    </span>
                    <span class="sidebar-label">Deal Flow</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('networking')" data-tab="networking" data-label="Networking">
                    <span class="sidebar-icon icon-networking">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </span>
                    <span class="sidebar-label">Networking</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('hiring')" data-tab="hiring" data-label="Hiring">
                    <span class="sidebar-icon icon-hiring">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                    </span>
                    <span class="sidebar-label">Hiring</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('general')" data-tab="general" data-label="General">
                    <span class="sidebar-icon icon-general">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </span>
                    <span class="sidebar-label">General</span>
                </button>
                <button class="sidebar-item" onclick="switchTab('spam')" data-tab="spam" data-label="Spam">
                    <span class="sidebar-icon icon-spam">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                    </span>
                    <span class="sidebar-label">Spam</span>
                </button>
            </div>
        </aside>
        {% endif %}

        <!-- Main Content Area -->
        <main class="main-content">
            {% if needs_setup %}
            <!-- First-Time Setup Screen -->
            <div class="setup-screen" id="setupScreen">
                <div class="setup-content">
                    <div class="setup-loading"></div>
                    <div class="setup-icon" id="setupIcon" style="display: none;">üöÄ</div>
                    <h2>Setting up your inbox...</h2>
                    <div class="setup-timer-container">
                        <div class="timer-display" id="timerDisplay">
                            <span class="timer-minutes" id="timerMinutes">5</span>
                            <span class="timer-separator">:</span>
                            <span class="timer-seconds" id="timerSeconds">00</span>
                        </div>
                        <p class="motivational-quote" id="motivationalQuote">Good things take time...</p>
                    </div>
                    <div class="setup-progress" id="setupProgress">
                        <div class="progress-bar-container">
                            <div class="progress-bar" id="setupProgressBar"></div>
                        </div>
                        <p class="progress-text" id="setupProgressText">Initializing...</p>
                    </div>
                </div>
            </div>
            {% endif %}
            
            {% if not has_gmail and not needs_setup %}
            <!-- Gmail Connection Required -->
            <div class="gmail-connection-prompt">
                <div class="gmail-connection-content">
                    <div class="gmail-connection-icon">üìß</div>
                    <h2>Connect Your Gmail Account</h2>
                    <p>To use Khair Email Replier Agent, you need to connect your Gmail account first.</p>
                    <p class="gmail-connection-subtitle">This allows the system to read and manage your emails securely.</p>
                    <a href="{{ url_for('connect_gmail') }}" class="btn btn-primary btn-large">
                        Connect Gmail Account
                    </a>
                </div>
            </div>
            {% endif %}
            
            {% if has_gmail %}
            <!-- Compact Header Section -->
            <div class="compact-header" {% if needs_setup %}style="display: none;"{% endif %}>
                <!-- Gmail Status (Compact) - Removed, now in navbar -->
                
                <!-- Controls -->
                <div class="controls-compact">
                    <div class="email-count-compact" id="emailCount"></div>
                </div>
            </div>

            <!-- Loading Indicator -->
            <div class="loading" id="loading" style="display: none;">
                <div class="spinner"></div>
                <p style="color: var(--text-secondary); font-weight: 500;">Loading emails...</p>
            </div>
            
            <!-- Older Emails Fetch Progress Bar -->
            <div class="older-emails-progress" id="olderEmailsProgress" style="display: none;">
                <div class="progress-container">
                    <div class="progress-header">
                        <span class="progress-title">üìß Fetching older emails...</span>
                        <button class="progress-close" onclick="stopOlderEmailsFetch()" title="Stop fetching">√ó</button>
                    </div>
                    <div class="progress-bar-wrapper">
                        <div class="progress-bar-fill" id="olderEmailsProgressBar"></div>
                    </div>
                    <div class="progress-stats" id="olderEmailsStats">
                        <span>Fetched: <strong id="olderEmailsFetched">0</strong></span>
                        <span>Classified: <strong id="olderEmailsClassified">0</strong></span>
                        <span>Total: <strong id="olderEmailsTotal">200</strong></span>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Email List / Deal Flow List - Always render, but hide during setup -->
            <div id="contentArea" {% if needs_setup %}style="display: none;"{% endif %}>
            <!-- Email List (for all tabs except Deal Flow) -->
            <div class="email-list" id="emailList">
                <div class="empty-state" id="emptyStateInitial" style="display: none;">
                    <div class="spinner"></div>
                    <p>Loading emails...</p>
                </div>
            </div>

            <!-- Deal Flow Table -->
            <div class="deal-flow-table" id="dealFlowTable" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0;">üíº Deal Flow</h2>
                    <!-- Scoring system removed - button disabled -->
                </div>
                <table class="deal-table">
                    <thead>
                        <tr>
                            <th>Founder</th>
                            <th>Subject</th>
                            <th>State</th>
                            <th>Deck Link</th>
                            <th>Basics</th>
                            <th>Portfolio Overlaps</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="dealFlowBody">
                        <tr>
                            <td colspan="8" class="empty-state">Loading deals...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            </div>
        </main>
    </div>

    <!-- Modal for email details -->
    <div class="modal" id="emailModal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div class="modal-header">
                <div class="modal-header-top">
                    <h2 id="modalSubject">Email Subject</h2>
                </div>
                <div class="modal-from-section">
                    <div class="modal-avatar" id="modalAvatar">A</div>
                    <div class="modal-from-info">
                        <span class="modal-from" id="modalFrom">Sender Name</span>
                        <span class="modal-from-email" id="modalFromEmail">sender@example.com</span>
                    </div>
                    <div class="modal-date" id="modalDate"></div>
                </div>
                <div class="modal-metadata">
                    <div id="modalTags" class="modal-tags"></div>
                </div>
            </div>
            
            <!-- Action Bar -->
            <div class="modal-action-bar">
                <button class="btn btn-primary btn-small" onclick="openReplyComposer()" title="Reply to this email">
                    <span class="btn-icon">‚Ü©Ô∏è</span> Reply
                </button>
                <button class="btn btn-secondary btn-small" onclick="openReplyAllComposer()" title="Reply to all recipients">
                    <span class="btn-icon">‚Ü©Ô∏è</span> Reply All
                </button>
                <button class="btn btn-secondary btn-small" onclick="openForwardComposer()" title="Forward this email">
                    <span class="btn-icon">‚û°Ô∏è</span> Forward
                </button>
                <button class="btn btn-danger btn-small" onclick="deleteCurrentEmail()" title="Delete this email">
                    <span class="btn-icon">üóëÔ∏è</span> Delete
                </button>
                <button class="btn btn-secondary btn-small" onclick="archiveEmail()" title="Archive this email">
                    <span class="btn-icon">üìÅ</span> Archive
                </button>
                <button class="btn btn-secondary btn-small" onclick="markAsUnread()" title="Mark as unread">
                    <span class="btn-icon">‚úâÔ∏è</span> Mark Unread
                </button>
            </div>
            
            <div class="modal-body">
                <div class="thread-container" id="threadContainer">
                    <!-- Thread messages will be populated here -->
                </div>
                
                <div class="email-body-section" id="singleEmailSection" style="display: none;">
                    <h3>Original Email</h3>
                    <div id="modalAttachments" style="margin-bottom: 16px;"></div>
                    <div class="email-body" id="modalBody"></div>
                </div>
                
                <!-- Rich Composer Section -->
                <div class="composer-section" id="composerSection" style="display: none;">
                    <h3 id="composerTitle">Reply</h3>
                    <div class="composer-form">
                        <div class="composer-field">
                            <label>To:</label>
                            <input type="email" id="composerTo" class="form-control" placeholder="recipient@example.com">
                        </div>
                        <div class="cc-bcc-toggle">
                            <button class="btn btn-small btn-text" onclick="toggleCCBCC()">Cc/Bcc</button>
                        </div>
                        <div class="cc-bcc-fields" id="ccBccFields" style="display: none;">
                            <div class="composer-field">
                                <label>Cc:</label>
                                <input type="email" id="composerCc" class="form-control" placeholder="cc@example.com">
                            </div>
                            <div class="composer-field">
                                <label>Bcc:</label>
                                <input type="email" id="composerBcc" class="form-control" placeholder="bcc@example.com">
                            </div>
                        </div>
                        <div class="composer-field">
                            <label>Subject:</label>
                            <input type="text" id="composerSubject" class="form-control" placeholder="Email subject">
                        </div>
                        <div class="composer-toolbar">
                            <button class="btn btn-small btn-icon" onclick="applyFormatting('bold')" title="Bold"><b>B</b></button>
                            <button class="btn btn-small btn-icon" onclick="applyFormatting('italic')" title="Italic"><i>I</i></button>
                            <button class="btn btn-small btn-icon" onclick="applyFormatting('underline')" title="Underline"><u>U</u></button>
                            <span class="toolbar-divider"></span>
                            <label class="btn btn-small btn-icon" title="Attach files">
                                üìé
                                <input type="file" id="composerFileInput" multiple style="display: none;" onchange="handleAttachmentUpload(event)">
                            </label>
                        </div>
                        <div class="composer-field">
                            <textarea id="composerBody" class="form-control composer-textarea" rows="10" placeholder="Write your message..."></textarea>
                        </div>
                        <div class="attachment-preview-list" id="attachmentPreviewList"></div>
                        <div class="composer-actions">
                            <button class="btn btn-primary" onclick="sendComposedEmail()">
                                ‚úâÔ∏è Send
                            </button>
                            <button class="btn btn-secondary" onclick="closeComposer()">
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="reply-section" id="replySection" style="display: none;">
                    <h3>AI Generated Reply</h3>
                    <div class="reply-controls">
                        <button class="btn btn-small btn-primary" onclick="generateReply()">
                            ü§ñ Generate Reply
                        </button>
                    </div>
                    <div class="reply-loading" id="replyLoading" style="display: none;">
                        <div class="spinner-small"></div>
                        <p>AI is generating a reply...</p>
                    </div>
                    <div class="reply-content" id="replyContent"></div>
                    <textarea class="reply-editor" id="replyEditor" style="display: none;"></textarea>
                    <div class="reply-actions" id="replyActions" style="display: none;">
                        <button class="btn btn-success" onclick="sendReply()">
                            ‚úâÔ∏è Send Reply
                        </button>
                        <button class="btn btn-secondary" onclick="editReply()">
                            ‚úèÔ∏è Edit
                        </button>
                        <button class="btn btn-danger" onclick="markAsRead()">
                            ‚úì Mark as Read (Skip)
                        </button>
                    </div>
                </div>
            </div>
        </div>
        </main>
    </div>


    <!-- Compose Email Modal -->
    <div class="modal" id="composeModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <span class="close" onclick="closeComposeModal()">&times;</span>
            <div class="modal-header">
                <h2>Compose Email</h2>
            </div>
            <div class="modal-body" style="padding: 24px;">
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-primary);">To:</label>
                    <input type="text" id="composeTo" class="compose-input" placeholder="recipient@example.com" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-primary);">Subject:</label>
                    <input type="text" id="composeSubject" class="compose-input" placeholder="Email subject" style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 6px; font-weight: 500; color: var(--text-primary);">Message:</label>
                    <textarea id="composeBody" class="compose-textarea" placeholder="Type your message here..." style="width: 100%; min-height: 300px; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; font-family: inherit; resize: vertical;"></textarea>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="closeComposeModal()">Cancel</button>
                    <button class="btn btn-primary" onclick="sendComposedEmail()" id="sendComposeBtn">
                        <span id="sendComposeBtnText">Send</span>
                        <span id="sendComposeBtnSpinner" style="display: none;" class="spinner-small"></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Signature Selector Modal -->
    <div class="modal" id="signatureModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close" onclick="closeSignatureModal()">&times;</span>
            <div class="modal-header">
                <h2>Select Email Signature</h2>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 16px; color: var(--text-secondary);">Choose which signature to use for your email replies:</p>
                <div id="signatureList" style="display: flex; flex-direction: column; gap: 12px;">
                    <div class="spinner-small"></div>
                    <p>Loading signatures...</p>
                </div>
            </div>
        </div>
    </div>

    {% if has_gmail %}
    <!-- Floating Compose Button -->
    <button class="floating-compose" onclick="openComposeModal()" title="Compose new email">
        ‚úâÔ∏è
    </button>
    {% endif %}

    <!-- Right-click Context Menu -->
    <div class="context-menu" id="contextMenu">
        <div class="context-menu-item" onclick="contextMenuReply()">
            <span>‚Ü©Ô∏è</span>
            <span>Reply</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuForward()">
            <span>‚Ü™Ô∏è</span>
            <span>Forward</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuArchive()">
            <span>üì¶</span>
            <span>Archive</span>
        </div>
        <div class="context-menu-item" onclick="contextMenuDelete()">
            <span>üóëÔ∏è</span>
            <span>Delete</span>
        </div>
    </div>

    <!-- Settings Modal with Tabs -->
    <div class="modal" id="settingsModal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>‚öôÔ∏è Settings</h2>
                <button class="modal-close" onclick="closeSettingsModal()">&times;</button>
            </div>
            
            <!-- Settings Tabs -->
            <div class="settings-tabs" style="display: flex; border-bottom: 2px solid var(--border-color); margin-bottom: 20px;">
                <button class="settings-tab active" onclick="switchSettingsTab('whatsapp')" id="tab-whatsapp">
                    üì± WhatsApp
                </button>
                <button class="settings-tab" onclick="switchSettingsTab('gmail')" id="tab-gmail">
                    üìß Gmail
                </button>
                <button class="settings-tab" onclick="switchSettingsTab('user')" id="tab-user">
                    üë§ User
                </button>
            </div>
            
            <div class="modal-body">
                <!-- WhatsApp Settings Tab -->
                <div class="settings-tab-content active" id="settings-whatsapp">
                    <div class="settings-section">
                        <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">
                            üì± WhatsApp Notifications
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
                            Receive instant WhatsApp alerts when new deal flow emails arrive, and automatic follow-up reminders every 6 hours.
                        </p>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label class="checkbox-label" style="display: flex; align-items: center; cursor: pointer;">
                                <input type="checkbox" id="whatsappEnabled" style="width: 18px; height: 18px; margin-right: 12px; cursor: pointer;">
                                <span style="font-weight: 500;">Enable WhatsApp alerts for deal flow</span>
                            </label>
                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px; margin-left: 30px;">
                                You'll receive alerts when new deals are detected and follow-ups every 6 hours
                            </p>
                        </div>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                WhatsApp Number
                            </label>
                            <input 
                                type="tel" 
                                id="whatsappNumber" 
                                placeholder="+1234567890" 
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary);"
                                pattern="^\+[1-9]\d{1,14}$"
                            >
                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                                Include country code (e.g., +1234567890). Reply "STOP" to WhatsApp to disable follow-ups.
                            </p>
                        </div>
                        
                        <div id="whatsappStatus" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
                    </div>
                </div>
                
                <!-- Gmail Settings Tab -->
                <div class="settings-tab-content" id="settings-gmail" style="display: none;">
                    <div class="settings-section">
                        <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">
                            üìß Gmail Connection
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
                            Manage your Gmail account connection and settings.
                        </p>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                Connected Email
                            </label>
                            <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <span id="gmailEmail" style="font-weight: 500;">{{ gmail_email if gmail_email else 'Not connected' }}</span>
                            </div>
                        </div>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                Connection Status
                            </label>
                            <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <span id="gmailStatus" style="font-weight: 500; color: #10b981;">
                                    {% if has_gmail %}‚úÖ Connected{% else %}‚ùå Not Connected{% endif %}
                                </span>
                            </div>
                        </div>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            {% if has_gmail %}
                            <button class="btn btn-secondary" onclick="disconnectGmail()" style="width: 100%;">
                                Disconnect Gmail
                            </button>
                            {% else %}
                            <a href="{{ url_for('connect_gmail') }}" class="btn btn-primary" style="width: 100%; text-decoration: none; display: block; text-align: center;">
                                Connect Gmail Account
                            </a>
                            {% endif %}
                        </div>
                        
                        <div id="gmailStatus" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
                    </div>
                </div>
                
                <!-- User Settings Tab -->
                <div class="settings-tab-content" id="settings-user" style="display: none;">
                    <div class="settings-section">
                        <h3 style="margin-top: 0; margin-bottom: 16px; font-size: 18px; font-weight: 600;">
                            üë§ User Profile
                        </h3>
                        <p style="color: var(--text-secondary); font-size: 14px; margin-bottom: 20px;">
                            Manage your account information and preferences.
                        </p>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                Username
                            </label>
                            <input 
                                type="text" 
                                id="userUsername" 
                                value="{{ current_user.username }}" 
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary);"
                                readonly
                            >
                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                                Username cannot be changed
                            </p>
                        </div>
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                Email
                            </label>
                            <input 
                                type="email" 
                                id="userEmail" 
                                value="{{ current_user.email }}" 
                                style="width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: var(--bg-primary); color: var(--text-primary);"
                                readonly
                            >
                            <p style="color: var(--text-secondary); font-size: 12px; margin-top: 4px;">
                                Email cannot be changed
                            </p>
                        </div>
                        
                        {% if current_user.full_name %}
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                Full Name
                            </label>
                            <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <span style="font-weight: 500;">{{ current_user.full_name }}</span>
                            </div>
                        </div>
                        {% endif %}
                        
                        <div class="settings-item" style="margin-bottom: 20px;">
                            <label style="display: block; font-weight: 500; margin-bottom: 8px;">
                                Account Created
                            </label>
                            <div style="padding: 12px; background: var(--bg-secondary); border-radius: 8px; border: 1px solid var(--border-color);">
                                <span>{{ current_user.created_at.strftime('%B %d, %Y') if current_user.created_at else 'Unknown' }}</span>
                            </div>
                        </div>
                        
                        <div id="userStatus" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 24px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                <button class="btn btn-secondary" onclick="closeSettingsModal()">Close</button>
                <button class="btn btn-primary" onclick="saveAllSettings()" id="saveSettingsBtn" style="display: none;">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/cache.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

